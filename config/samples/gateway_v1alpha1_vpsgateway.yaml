apiVersion: gateway.hmdyt.github.io/v1alpha1
kind: VPSGateway
metadata:
  labels:
    app.kubernetes.io/name: homelab-gateway-operator
    app.kubernetes.io/managed-by: kustomize
  name: main
  namespace: vps-gateway-system  # Namespace-scoped resource
spec:
  vps:
    address: "203.0.113.1"  # Replace with your VPS IP address (RFC 5737 TEST-NET-3)

  frp:
    port: 7000
    tokenSecretRef:
      name: frp-token
      key: token  # Optional: defaults to "token"
      namespace: vps-gateway-system  # Namespace where the secret is located
    image: "snowdreamtech/frpc:0.53.2"  # Optional: uses default if not specified

  ingress:
    enabled: true
    ingressClassName: "vps-gateway"  # Required: IngressClass name (managed by Helm)
    controller:
      enabled: true  # Optional: defaults to true (manages Traefik deployment)
      image: "traefik:v3.2"  # Optional: Traefik container image
      replicas: 1  # Optional: number of Traefik replicas
    tls:
      enabled: true  # Optional: defaults to true
      issuer: "letsencrypt-prod"  # Optional: defaults to "letsencrypt-prod"
    dns:
      enabled: true  # Optional: defaults to true (creates DNSEndpoint CRs for external-dns)
      ttl: 300  # Optional: DNS record TTL in seconds, defaults to 300

  egress:
    enabled: true  # Optional: defaults to false
    proxyPort: 3128  # Optional: defaults to 3128
    noProxy:  # Optional: list of hosts to bypass proxy
      - "localhost"
      - "127.0.0.1"
      - ".svc"
      - ".cluster.local"
      - "10.0.0.0/8"
      - "192.168.0.0/16"
